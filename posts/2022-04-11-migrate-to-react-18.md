---
date: 2022-04-11
title: React 18 ã¸ç§»è¡Œã™ã‚‹ã«ã‚ãŸã£ã¦
description: React 18 ãŒæ­£å¼ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã®ã‚’å—ã‘ã€ç°¡å˜ã«è¨˜éŒ²ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚
slug: migrate-to-react-18
reaction: ğŸ‘±ğŸ»â€â™€ï¸
category: Front
tags: 
 - React
 - TypeScript
---

3 æœˆ 30 æ—¥ã« React æœ¬ä½“ãŒã€é…ã‚Œã¦ 4 æœˆ 7 æ—¥ã«å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒªãƒªãƒ¼ã‚¹ã•ã‚ŒãŸã€‚

https://github.com/DefinitelyTyped/DefinitelyTyped/pull/56210

OSS ã® PR ã¨åˆã‚ã›ã€å–ã‚Šæ€¥ãå„ç¨®ãƒªãƒã‚¸ãƒˆãƒªã‚’æ›´æ–°ã—ãŸã€‚

- https://github.com/nekohack-oss/vite-react/tree/chore/react18
- https://github.com/jiyuujin/template-vite-react

## æ³¨æ„ã™ã‚‹ã¹ãã“ã¨

React 18 ã«æ›´æ–°ã™ã‚‹éš›ã€ãã®å¤‰æ›´å·®åˆ†ã¯å¤§ãããªã„ã‚‚ã®ã®ã€ã„ãã¤ã‹æ°—ã‚’ä»˜ã‘ãŸã„ã“ã¨ãŒã‚ã‚‹ã€‚

- `createRoot` ã¸ã®ä»•æ§˜å¤‰æ›´
- æš—é»™çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãŠã‘ã‚‹ Children ã®æ‰±ã„
- `useEffect` hook å‘¨è¾ºã®æŒ™å‹•ã«ç•™æ„
- React 18 ã®æ–°æ©Ÿèƒ½
  - Concurrency ãƒ¢ãƒ¼ãƒ‰
  - è‡ªå‹•ãƒãƒƒãƒå‡¦ç†
  - ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ (Transition)
  - ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã«ãŠã‘ã‚‹ React Suspense

### `createRoot` ã¸ã®ä»•æ§˜å¤‰æ›´

Root DOM ä½œæˆ API ã«å¤‰æ›´ãŒã‚ã£ãŸã€‚

- React 17 ã¾ã§ã¯ `ReactDOM.render` ã‚’ä½¿ã£ã¦ã„ãŸ
- React 18 ã§ã¯ `ReactDOM.createRoot` ã‚’ä½¿ã†

å…·ä½“çš„ãªå·®åˆ†ã¯ [ã‚³ãƒŸãƒƒãƒˆãƒ­ã‚°](https://github.com/jiyuujin/template-vite-react/commit/b6dcf252c22a68c89ca2ca4c21f212f4fcf86b1a) ã‚’ã”ç¢ºèªã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚

https://github.com/jiyuujin/template-vite-react/commit/b6dcf252c22a68c89ca2ca4c21f212f4fcf86b1a

Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ«ãƒ¼ãƒˆã§ `src/main.tsx` ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã‚‹ã§ã—ã‚‡ã†ã‘ã‚Œã©ã€ã“ã®å¤‰æ›´ç‚¹ã¯å¤§ãã„ã®ã§æ³¨æ„ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚

### æš—é»™çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãŠã‘ã‚‹ Children ã®æ‰±ã„

Children ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹ã‚‚ã®ã®ä¸‹è¨˜æš—é»™ã®å®£è¨€ã«ä¾å­˜ã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã¤ã„ã¦ã€å‰Šé™¤ã•ã‚Œã‚‹ç ´å£Šçš„å¤‰æ›´ãŒã‚ã‚Šæ³¨æ„ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ã€‚

- `React.FunctionComponent`
- `React.Component.Function`

```tsx
interface Props {
  children?: React.ReactNode
}

class SomeClassComponents React.Component<Props> {
  render() {
    return  <div>{this.props.children}</div>
  }
}
const SomeFunctionComponent: React.FunctionComponent<Props> = props => <div>{props.children}</div>
```

ã“ã®é€šã‚Šå ´åˆã«ã‚ˆã£ã¦ã¯ã€ã“ã‚Œã¾ã§ã®å‹ä»˜ã‘ã§å‹•ã‹ãªããªã£ã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒã‚ã‚‹ãŸã‚ã€ã“ã¡ã‚‰ã«ã‚‚æ³¨æ„ã—ã¦ã„ãŸã ã‘ã‚Œã°å¹¸ã„ã§ã™ã€‚

ãªãŠã€è‡ªå‹•åŒ–ã•ã‚ŒãŸ [ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ](https://github.com/eps1lon/types-react-codemod) ãŒã‚ã‚‹ã®ã§ã€ã“ã®åˆ©ç”¨ã‚‚æ¤œè¨ã™ã¹ãã§ã™ã€‚

https://github.com/eps1lon/types-react-codemod

#### `useEffect` hook å‘¨è¾ºã®æŒ™å‹•ã«ç•™æ„

StrictMode ã‚’å–ã‚Šå…¥ã‚Œã‚‹å‹•æ©ŸãŒã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ä»£ã‚ã‚Šã«ã€çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã“ã¨ã‚’å¯èƒ½ã«ã™ã‚‹ãŸã‚ã€‚

ã“ã®ç›®çš„ã‚’é”æˆã™ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã¨ãã¨åŒã˜ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ã‚’å‘¼ã³å‡ºã—ã¾ã™ãŒã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ DOM è¦ç´ ã®ä¸¡æ–¹ã®çŠ¶æ…‹ã‚’ä¿æŒã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãã‚Œã¯ã€ã™ãªã‚ã¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒã‚¦ãƒ³ãƒˆã¨ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã‚’è¤‡æ•°å›ç¹°ã‚Šè¿”ã™ã“ã¨ã‚’æ„å‘³ã—ã¦ãŠã‚Šã€è¤‡æ•°å›å‘¼ã³å‡ºã•ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ `useEffect` ã§ `init()` ã—ãªã„æ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚

ã¾ãŸ React 18 ã®æ–°æ©Ÿèƒ½ã®ã²ã¨ã¤ Concurrency ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ä½œæ¥­ã‚’åˆ†å‰²ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ä½œæ¥­ã‚’ä¸€æ™‚åœæ­¢ãŠã‚ˆã³å†é–‹ã—ã¾ã™ã€‚

https://reactjs.org/docs/strict-mode.html#detecting-unexpected-side-effects

ã“ã‚Œã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®é…ã„å ´åˆãŒã‚ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚

### React 18 ã®æ–°æ©Ÿèƒ½

æ˜¨å¹´æš®ã‚Œã«ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è¨˜äº‹ã®ã²ã¨ã¤ã¨ã—ã¦ã€ç°¡å˜ã« React 18 ã®è¨˜äº‹ã‚’æ›¸ã‹ã›ã¦ã„ãŸã ã„ãŸã€‚

React Conf ã§ã‚‚è§¦ã‚Œã‚‰ã‚Œã¦ã„ãŸé–¢ä¿‚ã‹ã‚‰ React Suspense ã‚‚åˆã‚ã›ã¦è§£èª¬ã—ã¦ã„ã‚‹ã€‚

https://webneko.dev/posts/upcoming-react-18-in-2022

#### Concurrency ãƒ¢ãƒ¼ãƒ‰

Concurrency ãƒ¢ãƒ¼ãƒ‰ã¯ã€ã‚¢ãƒªã‚¹ã¨ãƒœãƒ–ã® 2 äººã«é›»è©±ã™ã‚‹ä¾‹ã‚’ã¨ã‚Šã€ä¸Šæ‰‹ãè§£èª¬ã—ã¦ãã‚Œã¦ã„ã‚‹ [Github discussion](https://github.com/reactwg/react-18/discussions/46) ã‚’ç¢ºèªã„ãŸã ããŸã„ã€‚

https://github.com/reactwg/react-18/discussions/46

ã“ã‚Œã¾ã§ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯å˜ä¸€ã§ä¸­æ–­ã•ã‚Œã‚‹ã“ã¨ã®ãªã„åŒæœŸãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚ã‚Šã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒé–‹å§‹ã•ã‚Œã‚‹ã¨ä¸­æ–­ã§ãã¾ã›ã‚“ã€‚

ã—ã‹ã— React 18 ã§ã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ä¸­æ–­ã€ä¸€æ™‚åœæ­¢ã€å†é–‹ã€ã¾ãŸã¯æ”¾æ£„ã§ãã‚‹ã€‚

#### è‡ªå‹•ãƒãƒƒãƒå‡¦ç†

æ–‡å­—é€šã‚Š React 18 ä»¥é™ã€ã‚¤ãƒ™ãƒ³ãƒˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§å…¨ã¦ã®çŠ¶æ…‹ã®æ›´æ–°ã‚’å¯èƒ½ã«ã—ãŸã€‚

ã“ã®è‡ªå‹•ãƒãƒƒãƒå‡¦ç†ã¯ã€ä¸‹è¨˜ [Github discussion](https://github.com/reactwg/react-18/discussions/46#discussioncomment-846694) ã‚’ç¢ºèªã„ãŸã ããŸã„ã€‚

https://github.com/reactwg/react-18/discussions/46#discussioncomment-846694

#### ãƒˆãƒ©ãƒ³ã‚¸ã‚·ãƒ§ãƒ³ (Transition)

`startTransition` ã¯ `setTimeout` ã¨ç•°ãªã‚Šã™ãã«å®Ÿè¡Œã•ã‚Œã‚‹ã€‚ `setTimeout` ã«ã¯ä¿è¨¼ã•ã‚ŒãŸé…å»¶ãŒå­˜åœ¨ã™ã‚‹ä¸€æ–¹ã€ `startTransition` ã¯ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¹ãƒšãƒƒã‚¯ã‚„ç·Šæ€¥ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã«ã‚ˆã£ã¦ã€ã©ã®ç¨‹åº¦é…å»¶ã™ã‚‹ã‹ç•°ãªã‚‹ã€‚

```tsx
import { startTransition } from 'react'

// Transition
startTransition(() => {
  setCounter(counter)
})
```

## æœ€å¾Œã«

ãã‚Œãã‚Œã®é …ç›®ã«ã¤ã„ã¦ã€åˆ¥é€”æ·±ãè§£èª¬ã™ã‚‹æ™‚é–“ã‚’å–ã‚‰ã›ã¦ã„ãŸã ãã¨ã—ã¦ã€ã„ã¾ä¸€åº¦ React 18 ã‚’å­¦ã‚“ã§ãŠããŸã„æ¬¡ç¬¬ã§ã™ã€‚
